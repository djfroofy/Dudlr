{% extends 'base.html' %}
{% block title %}Demo{% endblock %}
{% block head %}
 {{ super() }}
 <script type="text/javascript" language="javascript">


     $(document).ready(function() {

        function uploadDudle(dudle) {
            var upload = function(format, data, width, height) {
                var s = "" + data;
                console.log("uploading : " + dudle.id);
                $.post('/json/dudles/update', {
                    id:dudle.id, data:s,
                    format:format, width: width, height: height
                    }, function() {
                        console.log("done"); 
                        $('#status>em').text('Saved');
                    });
             }
             dudle.save(upload, 'L'); 
        }

        function saveDudle(dudle) {
            console.log("saving dudle : " + dudle);
            $('#status>em').text('Saving ...');

            if (dudle.id) {
                uploadDudle(dudle);
                return;
            }

            $.post('/json/dudles/save', {}, function(json) {
                console.log('response : ' + json);
                console.log("got id : " + json.id);
                dudle.id = json.id;
                uploadDudle(dudle);
            }, 'json');
        }
        

        $("#dudlr-canvas").dudlrCanvas();
        $().keyup(function(evt) {
            if (evt.keyCode == 83) {
                saveDudle($.dudlrCanvases()[0]);
            }
        });
     });
 </script>
{% endblock %}

{% block content_main %}
<div id="dudlr-canvas-block">

    <canvas id="dudlr-canvas" width="500" height="250">
    Your browser doesn't support the canvas element. That's too bad.
    </canvas>

    <div id="legend">
        <div id="status"><em></em></div>
        <div><em>Fill Mode: <span id="fill-mode">none</span></em></div>

        <ul id="controls-help">
            <li>Press <strong>F</strong> to toggle Fill Mode</li>
            <li>Press <strong>S</strong> to Save</li>
        </ul>
    </div>


</div>
{% endblock %}
